{%- liquid
  assign color_tle = 'var(--color-extra-accent-bg)'
  assign id = section.id | md5 | truncate: 12, ''
  if section.settings.accent_scheme == 'color-accent-1'
    assign color_tle = 'var(--color-main-accent-bg)'
  endif
  if settings.enable_content_max_width
    assign carousel_class = 'carousel-content-width o-hidden-md'
  endif
  assign md = 12.0 | divided_by : section.settings.items_per_row_on_desktop
-%}


<div class="section color-{{ section.settings.color_scheme }} {{ section.settings.remove_padding_top | replace: 'true', 'section-top-zero' | replace: section.settings.remove_padding_top, '' }} {{ section.settings.remove_padding_bottom | replace: 'true', 'section-bottom-zero' | replace: section.settings.remove_padding_bottom, '' }} {% render 'animation-loader', section: section %}" data-ui-component="Timeline Section" role="region" aria-labelledby="sectionHeading-{{ id }}">
  <div class="ctnr">
    {%- render 'section-header', content_align: section.settings.content_alignment, subheading: section.settings.subheading, heading: section.settings.heading, description: section.settings.description, section: section -%}
    <div class="s-content {{ carousel_class }}">
      <div aria-atomic="true" class="timeline ox-md-auto pt-md-12 o-hidden rw p-relative fw-nowrap scrollable scrollable-x fd-column fd-row-md js-animate">
        {%- for block in section.blocks -%}
          {%- liquid
            assign loading = "lazy"
            assign decoding ="async"
            assign fetchpriority = "auto"

            if section.index == 1 and forloop.first
              assign loading = "eager"
              assign fetchpriority = "high"
            endif

            assign media_width_desktop = 'calc(100vw / ' | append: section.settings.items_per_row_on_desktop | append: ')'

            if settings.enable_content_max_width
              assign media_width_desktop = 'calc(min(100vw, ' | append: settings.content_max_width | append: 'px) / ' | append: section.settings.items_per_row_on_desktop | append: ')'
            endif
            assign sizes = '(min-width: 769px) ' | append: media_width_desktop | append: ', ' | append: '100vw'
            assign widths = '240, 352, 550, 832, 1200, 1600, 1920, 2560, 3840'

            assign tlt_image = ''
            assign tlt_image = block.settings.media | image_url: width: block.settings.media.width | image_tag: widths: widths, sizes: sizes, alt: block.settings.heading, class: 'js-image-lazy media of-cover w-100', loading: loading, fetchpriority: fetchpriority, decoding: decoding

            assign ratio = section.settings.image_ratio
            if section.settings.image_ratio == 'auto'
              assign ratio = block.settings.media.aspect_ratio
            endif
          -%}
          <div role="group" aria-roledescription="Slide" aria-label="{{ 'accessibility.slide' | t }} {{ forloop.index }} {{ 'accessibility.of' | t }} {{ forloop.length }}" class="timeline__item clm js-carousel-item p-relative scrollable-aln-start fg-1 fs-0 anm anm-fadeInUp" style="--color-tle: {{ color_tle }};--w-xs:12;--w-md: {{ md }};--delay: {{ forloop.index | times: 0.05 -}}s; --duration: .6s" {{ block.shopify_attributes }}>
                <div class="timeline__content pl-52 p-zero-md">
                  <span class="timeline__date d-inline-block h6 mb-16 pr-12 pl-12 hide-empty {{ section.settings.accent_scheme }}">{{- block.settings.date -}}</span>
                  <sht-clps-rgn class="collapsible-region" data-properties='{"isCollapsibleOnDesktop":false, "isCollapsibleOnMobile":true, "ariaDescribedby": "clsbeTgr-{{ id }}-{{ forloop.index }}", "ariaControls": "clsbeCtt-{{ id }}-{{ forloop.index }}"}'>
                    <button id="clsbeTgr-{{ id }}-{{ forloop.index }}" class="btn-collapsible p-relative bg-transparent w-100 p-zero b-zero d-flex between-xs middle-xs wb-break-word js-collapsible-region-trigger {{ section.settings.enable_collapsible | default: 'open' | replace: 'true', 'c-pointer' }}" aria-controls="clsbeCtt-{{ id }}-{{ forloop.index }}" aria-expanded="false">
                      <h3 class="h6 m-zero ta-left hide-empty">{{- block.settings.heading -}}</h3>
                      <div class="timeline-arrow d-none-md padding--end ml-8 {% if section.settings.enable_collapsible == false or block.settings.heading == blank or block.settings.description == blank and block.settings.media == blank %} hidden {% endif %}">
                        {% render 'icon-arrow-animation' %}
                      </div>
                    </button>
                <div id="clsbeCtt-{{ id }}-{{ forloop.index }}" class="{% if block.settings.heading == blank %} d-block {% endif %} collapsible-region__content js-collapsible-region-content {{ section.settings.enable_collapsible | default: 'd-block' | replace: 'true', '' }}" role="region" tabindex="-1" aria-describedby="clsbeTgr-{{ id }}-{{ forloop.index }}" hidden>
                  {% if block.settings.media != blank %}
                    <div class="mt-16">
                      {% render 'image', ratio: ratio, image_item: tlt_image %}
                    </div>
                  {% endif %}
                  <div class="mt-12 text-block hide-empty">{{- block.settings.description -}}</div>
                  {% if block.settings.button_label != blank %}
                    <a href="{{ block.settings.button_link | default: '#' }}" {{ block.settings.button_link | default: 'tabindex="-1"' | replace: block.settings.button_link , '' }} class="btn btn-link hide-empty mt-8" {% if block.settings.button_link_new_tab %} target="_blank" {% endif %}>
                      {{- block.settings.button_label | escape -}}
                    </a>
                  {% endif %}
                </div>
              </sht-clps-rgn>
            </div>
          </div>
        {%- endfor -%}
      </div>
    </div>
  </div>
</div>
{% schema %}
{
  "name": "t:general.timeline",
  "disabled_on": {
    "groups": [
      "header",
      "footer"
    ]
  },
  "settings": [
    {
      "type": "header",
      "content": "t:general.general"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:general.color_scheme"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "t:general.section_subheading"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:general.section_heading",
      "default": "Timeline"
    },
    {
      "type": "text",
      "id": "description",
      "label": "t:general.section_description"
    },
    {
      "type": "checkbox",
      "id": "enable_collapsible",
      "label": "t:general.collapse_mobile",
      "info": "t:general.timeline_mobile_info",
      "default": true
    },
    {
      "type": "header",
      "content": "t:general.timeline_header"
    },
    {
      "type": "select",
      "id": "accent_scheme",
      "label": "t:general.accent_scheme",
      "default": "color-accent-1",
      "options": [
        {
          "value": "color-accent-1",
          "label": "t:general.main"
        },
        {
          "value": "color-accent-2",
          "label": "t:general.extra"
        }
      ]
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "t:general.image_ratio",
      "default": "auto",
      "options": [
        {
          "value": "1/1",
          "label": "t:general.square"
        },
        {
          "value": "2/3",
          "label": "t:general.portrait"
        },
        {
          "value": "3/2",
          "label": "t:general.landscape"
        },
        {
          "value": "auto",
          "label": "t:general.adapt_to_image"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:general.layout"
    },
    {
      "type": "select",
      "id": "items_per_row_on_desktop",
      "label": "t:general.items_per_row_on_desktop",
      "default": "4",
      "options": [
        {
          "value": "3",
          "label": "3"
        },
        {
          "value": "4",
          "label": "4"
        },
        {
          "value": "5",
          "label": "5"
        },
        {
          "value": "6",
          "label": "6"
        }
      ]
    },
    {
      "type": "select",
      "id": "content_alignment",
      "label": "t:general.content_alignment",
      "default": "ta-left",
      "options": [
        {
          "value": "ta-left",
          "label": "t:general.left"
        },
        {
          "value": "ta-center",
          "label": "t:general.center"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "remove_padding_top",
      "label": "t:general.remove_padding_top",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "remove_padding_bottom",
      "label": "t:general.remove_padding_bottom",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "t:general.timeline_item",
      "settings": [
        {
          "type": "text",
          "id": "date",
          "label": "t:general.label",
          "default": "2010"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "t:general.heading",
          "default": "Heading"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "t:general.description",
          "default": "<p>Write content about your store</p>"
        },
        {
          "type": "image_picker",
          "id": "media",
          "label": "t:general.image"
        },
        {
          "type": "header",
          "content": "t:general.link"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "t:general.label",
          "default": "Learn more"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "t:general.link",
          "visible_if": "{{ block.settings.button_label != blank }}"
        },
        {
          "type": "checkbox",
          "id": "button_link_new_tab",
          "label": "t:general.open_link_in_a_new_tab",
          "visible_if": "{{ block.settings.button_link != blank }}",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:general.timeline",
      "blocks": [
        {
          "type": "item"
        },
        {
          "type": "item",
          "settings": {
            "date": "2015"
          }
        },
        {
          "type": "item",
          "settings": {
            "date": "2020"
          }
        },
        {
          "type": "item",
          "settings": {
            "date": "2022"
          }
        },
        {
          "type": "item",
          "settings": {
            "date": "2025"
          }
        }
      ]
    }
  ]
}
{% endschema %}
