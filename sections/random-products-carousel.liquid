{% comment %}
  Random Products Carousel (Synced)
  - Renders products from a chosen collection
  - JS will hide/show random subset (synced by seed)
{% endcomment %}

<section
  class="rp-carousel section"
  data-rp-carousel="true"
  data-rp-count="{{ section.settings.limit }}"
  data-rp-seed-mode="{{ section.settings.seed_mode }}"
>
  <div class="rp-carousel__inner page-width">
    {% if section.settings.heading != blank %}
      <h2 class="rp-carousel__heading" style="text-align: {{ section.settings.align }};">
        {{ section.settings.heading }}
      </h2>
    {% endif %}

    {% assign coll = section.settings.collection %}
    {% if coll != blank and coll.products_count > 0 %}
      <div class="rp-carousel__grid">
        {% for product in coll.products limit: section.settings.max_pool %}
          <article class="rp-card" data-rp-item>
            <a class="rp-card__link" href="{{ product.url }}">
              <div class="rp-card__media">
                {% if product.featured_image %}
                  {{ product.featured_image | image_url: width: 800 | image_tag: loading: 'lazy', class: 'rp-card__img' }}
                {% else %}
                  {{ 'product-apparel-1' | placeholder_svg_tag: 'rp-card__img' }}
                {% endif %}
              </div>

              <div class="rp-card__info" style="text-align: {{ section.settings.align }};">
                <div class="rp-card__title">{{ product.title }}</div>
                {% if section.settings.show_price %}
                  <div class="rp-card__price">
                    {{ product.price | money }}
                  </div>
                {% endif %}
              </div>
            </a>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p style="text-align: center;">בחר Collection בהגדרות של ה-Section כדי להציג מוצרים.</p>
    {% endif %}
  </div>
</section>

{% style %}
  .rp-carousel { 
    padding: 24px 0; 
  }
  .rp-carousel__heading { 
    margin: 0 0 16px; 
    font-size: 22px; 
    font-weight: 700;
  }
  .rp-carousel__grid {
    display: grid;
    gap: 16px;
    grid-template-columns: repeat({{ section.settings.columns_desktop }}, minmax(0, 1fr));
  }
  .rp-card {
    display: flex;
    flex-direction: column;
  }
  .rp-card__link {
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  .rp-card__media { 
    aspect-ratio: 1 / 1; 
    overflow: hidden; 
    border-radius: 12px;
    background: #f5f5f5;
  }
  .rp-card__img { 
    width: 100%; 
    height: 100%; 
    object-fit: cover; 
    display: block; 
  }
  .rp-card__info {
    padding: 12px 0;
  }
  .rp-card__title { 
    font-size: 14px; 
    margin-top: 10px; 
    font-weight: 500;
    line-height: 1.4;
  }
  .rp-card__price { 
    font-size: 13px; 
    margin-top: 6px; 
    opacity: .9; 
    font-weight: 600;
  }

  @media (max-width: 749px){
    .rp-carousel__grid { 
      grid-template-columns: repeat({{ section.settings.columns_mobile }}, minmax(0, 1fr)); 
    }
    .rp-carousel__heading { 
      font-size: 18px; 
    }
    .rp-carousel {
      padding: 16px 0;
    }
  }
{% endstyle %}

{% schema %}
{
  "name": "Random products (synced)",
  "settings": [
    { 
      "type": "text", 
      "id": "heading", 
      "label": "Heading", 
      "default": "You may also like" 
    },
    { 
      "type": "select", 
      "id": "align", 
      "label": "Text alignment", 
      "default": "center",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ]
    },
    { 
      "type": "collection", 
      "id": "collection", 
      "label": "Collection source" 
    },
    { 
      "type": "range", 
      "id": "limit", 
      "label": "How many to show", 
      "min": 2, 
      "max": 12, 
      "step": 1, 
      "default": 6 
    },
    { 
      "type": "range", 
      "id": "max_pool", 
      "label": "Pool size (how many to load then randomize)", 
      "min": 6, 
      "max": 50, 
      "step": 1, 
      "default": 24 
    },
    { 
      "type": "select", 
      "id": "seed_mode", 
      "label": "Random sync mode", 
      "default": "daily",
      "options": [
        { "value": "daily", "label": "Synced daily (same across pages, changes daily)" },
        { "value": "visit", "label": "Synced per visit (same across pages for visitor)" }
      ]
    },
    { 
      "type": "checkbox", 
      "id": "show_price", 
      "label": "Show price", 
      "default": true 
    },
    { 
      "type": "range", 
      "id": "columns_desktop", 
      "label": "Columns on desktop", 
      "min": 2, 
      "max": 6, 
      "step": 1, 
      "default": 4 
    },
    { 
      "type": "range", 
      "id": "columns_mobile", 
      "label": "Columns on mobile", 
      "min": 1, 
      "max": 2, 
      "step": 1, 
      "default": 1 
    }
  ],
  "presets": [
    { "name": "Random products (synced)" }
  ]
}
{% endschema %}
