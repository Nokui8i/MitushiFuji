{%- liquid
  assign loading = "lazy"
  assign decoding ="async"
  assign fetchpriority = "auto"

  if section.index == 1
    assign loading = "eager"
    assign fetchpriority = "high"
  endif

  assign media_width_desktop = 'calc(100vw / 12 * 7), 100vw'

  if settings.enable_content_max_width
    assign media_width_desktop = 'calc(min(100vw, ' | append: settings.content_max_width | append: 'px) / 7 * 10)'
  endif

  assign sizes = '(min-width: 769px) ' | append: media_width_desktop | append: ', ' | append: '100vw'
  assign widths = '240, 352, 550, 832, 1200, 1600, 1920, 2560, 3840'

  assign placeholder = 'blog-apparel-3' | placeholder_svg_tag: 'placeholder media of-cover w-100 h-100'
  assign map_media = placeholder
  assign media_alt = section.settings.image.alt | default: section.settings.image.image | split: '/' | last
  assign map_media = section.settings.image | image_url: width: section.settings.image.width, height: section.settings.image.height | image_tag: widths: widths, sizes: sizes, alt: media_alt, class: 'js-image-lazy media of-cover w-100 h-100', loading: loading, fetchpriority: fetchpriority, decoding: decoding
  assign map_address = section.settings.map_address
  assign map_media_width = '--w-xs:12'

  assign direction = 'ltr'
  if settings.enable_right_to_left
    assign direction = 'rtl'
  endif
-%}
<div class="section color-{{- section.settings.color_scheme }} {{ section.settings.remove_padding_top | replace: 'true', 'section-top-zero' | replace: section.settings.remove_padding_top, '' }} {{ section.settings.remove_padding_bottom | replace: 'true', 'section-bottom-zero' | replace: section.settings.remove_padding_bottom, '' }} {% render 'animation-loader', section: section %}" data-ui-component="Map Section">
  <div class="ctnr">
    <div class="rw section-map r-gap-48 r-gap-sm-64 {{ section.settings.content_ordering }}">
      {%- if section.blocks.size != 0 -%}
        {% liquid
          assign map_media_width = '--w-xs:12;--w-md:6'
        %}
        {%- for block in section.blocks -%}
          <div class="clm" style="--w-xs:12;--w-md:6;direction: {{ direction }};" {{ section.shopify_attributes }}>
            {% render 'section-header',
              classes: 'section-map-header',
              subheading: block.settings.subheading,
              heading: block.settings.heading,
              description: block.settings.description,
              description_extra_class: 'mie-zero',
              section: section %}
            {%- unless map_address == blank or block.settings.button_text == blank -%}
              <div class="s-footer-sm">
                <a href="{{ map_address | url_encode | prepend: 'https://www.google.com/maps/place/' }}" target="_blank" class="btn btn-primary--animate btn-small">
                  <span class="d-block o-hidden p-relative">
                    <span class="btn-primary__content">
                      {{- block.settings.button_text | escape -}}
                    </span>
                  </span>
                </a>
              </div>
            {%- endunless -%}
          </div>
        {%- endfor -%}
      {%- endif -%}
      <div class="clm" style="{{ map_media_width }}">
        <div class="map-media" style="--h-xs:35vh;--h-lg:70vh">
          {%- if section.settings.image != blank or section.settings.image == blank and map_address == blank -%}
            <div class="h-100 o-hidden">
              {% render 'image', image_item: map_media, image_wrap_classes: 'h-100', image_classes: 'h-100 js-animate anm anm-zoomOut', media_wrap_style: '--delay: .6s;' %}
            </div>
          {%- else -%}
            <sht-map data-zoom="14" data-type="roadmap" data-location="{{ map_address }}">
              <iframe defer class="js-map-iframe w-100 h-100 d-block" loading="lazy" scrolling="no" title="Google Map" src="" srcdoc="loading..."></iframe>
            </sht-map>
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>
</div>
{% schema %}
{
  "name": "t:general.map",
  "disabled_on": {
    "groups": [
      "header",
      "footer"
    ]
  },
  "settings": [
    {
      "type": "header",
      "content": "t:general.general"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:general.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "text",
      "id": "map_address",
      "label": "t:general.address",
      "info": "t:general.map_address_info",
      "default": "Brooklyn, NY, USA"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "t:general.image",
      "info": "t:general.custom_map_image_info"
    },
    {
      "type": "header",
      "content": "t:general.layout"
    },
    {
      "type": "select",
      "id": "content_ordering",
      "label": "t:general.content_ordering_on_desktop",
      "default": "text-first",
      "options": [
        {
          "value": "text-first",
          "label": "t:general.text_first"
        },
        {
          "value": "d-rtl",
          "label": "t:general.map_first"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "remove_padding_top",
      "label": "t:general.remove_padding_top",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "remove_padding_bottom",
      "label": "t:general.remove_padding_bottom",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "content",
      "name": "t:general.content",
      "limit": 1,
      "settings": [
        {
          "type": "header",
          "content": "t:general.text"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "t:general.subheading",
          "default": "Location"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "t:general.heading",
          "default": "Map"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "t:general.description",
          "default": "<p>Write about your physical store locations, opening hours, etc.</p>"
        },
        {
          "type": "header",
          "content": "t:general.button"
        },
        {
          "type": "paragraph",
          "content": "t:general.map_direction_button_info"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "t:general.label",
          "info": "t:general.hide_if_empty_info",
          "default": "Get direction"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:general.map",
      "blocks": [
        {
          "type": "content"
        }
      ]
    }
  ]
}
{% endschema %}
