{%- liquid
  assign loading = "lazy"
  assign decoding ="async"
  assign fetchpriority = "auto"

  if section.index == 1
    assign loading = "eager"
    assign fetchpriority = "high"
  endif

  assign media_width_desktop = 'calc(100vw / 12 * 8), 100vw'

  if settings.enable_content_max_width
    assign media_width_desktop = 'calc(min(100vw, ' | append: settings.content_max_width | append: 'px) / 12 * 8)'
  endif

  assign sizes = '(min-width: 769px) ' | append: media_width_desktop | append: ', ' | append: '100vw'
  assign widths = '240, 352, 550, 832, 1200, 1600, 1920, 2560, 3840'

  assign placeholder = 'collection-apparel-1' | placeholder_svg_tag: 'placeholder js-image-lazy media of-cover'
  assign hotspot_image = placeholder
  assign hotspot_image_alt = section.settings.image_hotspot.alt | default: section.settings.image_hotspot.image | split: '/' | last
  assign hotspot_image = section.settings.image_hotspot | image_url: width: section.settings.image_hotspot.width | image_tag: widths: widths, sizes: sizes, alt: hotspot_image_alt, class: 'js-image-lazy js-grid-image media of-cover w-100', loading: loading, fetchpriority: fetchpriority, decoding: decoding
  assign s_content_class = ''
  if section.settings.show_navigation == false or section.blocks.size == 1
    assign s_content_class = 'gap-unequal'
  endif
-%}

<div class="section color-{{- section.settings.color_scheme }} {{ section.settings.remove_padding_top | replace: 'true', 'section-top-zero' | replace: section.settings.remove_padding_top, '' }} {{ section.settings.remove_padding_bottom | replace: 'true', 'section-bottom-zero' | replace: section.settings.remove_padding_bottom, '' }} {% render 'animation-loader', section: section %} product-hotspots-with-blurred-background" data-ui-component="Product Hotspots Section" role="region" aria-labelledby="sectionHeading-{{ section.id | md5 | truncate: 12, "" }}" style="--darkness-opacity: {{ darkness_opacity }};">
  <div class="ctnr">
    {% render 'section-header', content_align: 'ta-left', subheading: section.settings.subheading, heading: section.settings.heading, description: section.settings.description, badge_text: section.settings.badge_text, badge_position: section.settings.badge_position, badge_shape: section.settings.badge_shape, badge_color: section.settings.badge_color, section: section %}
    <div class="s-content rw middle-xs {{ s_content_class }} product-hotspots-with-statistics">
      <div class="clm" style="--w-xs:12;--w-sm:12;--w-md:6;">
        <div class="p-relative hotspot-container-glow" id="hotspotContainer-{{ section.id }}">
          <sht-grid class="p-relative h-100 w-100 d-block">
            <div class="p-relative js-grid o-hidden">
              {% render 'image', image_item: hotspot_image, ratio: section.settings.image_hotspot.aspect_ratio, image_classes: 'js-animate anm anm-zoomOut', media_wrap_style: '--delay: .0s;' %}
            </div>
            <sht-hotspot data-container-id="hotspotContainer-{{ section.id }}" class="p-absolute h-100 w-100 left-0 top-0">
              <sht-carousel-trig id="carouselTrigger-{{ section.id }}" data-carousel-target="carousel-{{ section.id }}" class="p-relative h-100 w-100 d-block">
                {% for block in section.blocks %}
                  {% if block.type == 'hotspot' %}
                    {%- liquid
                      assign active_class = ''
                      assign aria_current = ''
                      if forloop.first
                        assign active_class = ' hotspot-item--active'
                        assign aria_current = ' aria-current="true"'
                      endif
                     -%}
                    <button style="--axis-x: {{ block.settings.left_offset }}%; --axis-y: {{ block.settings.top_offset }}%" class="js-carousel-trigger js-tooltip-placeholder js-hotspot-link p-absolute hotspot-item br-50p d-flex middle-xs center-xs c-pointer {{ active_class }} b-zero" {{ aria_current }} aria-describedby="carouselItem-{{ forloop.index }}-{{ section.id }}" aria-label="{{ 'products.product.media.load_product_hotspot' | t: product_name: block.settings.product.title }}" aria-controls="carousel-{{ section.id }}" type="button" data-product-url="{{ block.settings.product.url }}">
                      <span class="hotspot-inner-clickable br-50p"></span>
                      <span class="hotspot-content opacity-0 js-tooltip-content p-absolute zi-1 ta-left fs-body">
                        <span class="h6 mb-8 d-block">
                          {{ block.settings.product.title }}
                        </span>
                        {% render 'product-price', product: block.settings.product, target: block.settings.product %}
                      </span>
                    </button>
                  {% endif %}
                {% endfor %}
              </sht-carousel-trig>
            </sht-hotspot>
          </sht-grid>
        </div>
      </div>
      {% if section.blocks.size > 0 %}
        {% assign has_statistics = false %}
        {% for block in section.blocks %}
          {% if block.type == 'statistic' %}
            {% assign has_statistics = true %}
            {% break %}
          {% endif %}
        {% endfor %}
        {% if has_statistics %}
          <div class="clm" style="--w-xs:12;--w-sm:12;--w-md:6;">
            <div class="statistics-content-wrapper">
              <sht-carousel class="p-relative d-block statistics-carousel">
                <div aria-atomic="true" class="d-flex fw-nowrap carousel ox-auto p-relative scrollable scrollable-x disable-scrollbars js-carousel-items">
                  {% for block in section.blocks %}
                    {% if block.type == 'statistic' %}
                      <sht-carousel-itm tabindex="0" class="carousel__item clm js-carousel-item p-relative scrollable-aln-start d-flex fd-column middle-xs fg-1 fs-0 p-zero" role="group" aria-roledescription="Slide" aria-label="{{ 'accessibility.slide' | t }} {{ forloop.index }} {{ 'accessibility.of' | t }} {{ forloop.length }}" style="--w-xs:12;--w-sm:12;--w-md:12;" {{ block.shopify_attributes }}>
                        <div class="statistics-item ta-center">
                          <div class="statistics-number">
                            <span class="js-number-animate" data-target="100000" data-duration="{{ section.settings.animation_duration | default: 1000 }}" data-auto-plus="true">0</span><span class="statistics-suffix statistics-suffix-auto">+</span>
                          </div>
                          
                          {% if block.settings.label != blank %}
                            <div class="statistics-label">
                              {{ block.settings.label }}
                            </div>
                          {% endif %}
                          
                          {% if block.settings.description != blank %}
                            <div class="statistics-description">
                              {{ block.settings.description }}
                            </div>
                          {% endif %}
                        </div>
                      </sht-carousel-itm>
                    {% endif %}
                  {% endfor %}
                </div>
                {% if section.settings.show_statistics_navigation != false %}
                  <div class="carousel-pagination middle-y w-100 p-absolute no-js-hidden zi-1 d-flex">
                    <div class="p-absolute left-0">
                      <button type="button" data-step="1" class="js-carousel-prev-btn btn btn-primary--animate rtl-flip-x btn-icon btn-small p-absolute middle-y left-0 zi-1" aria-label="{{ 'accessibility.previous_slide' | t }}" name="previous" disabled>{% render 'icon-chevron-left' %}</button>
                    </div>
                    <div class="p-absolute right-0">
                      <button type="button" data-step="1" class="js-carousel-next-btn btn btn-primary--animate rtl-flip-x btn-icon btn-small p-absolute middle-y right-0 zi-1" aria-label="{{ 'accessibility.next_slide' | t }}" name="next" disabled>{% render 'icon-chevron-right' %}</button>
                    </div>
                  </div>
                {% endif %}
              </sht-carousel>
            </div>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </div>
</div>

<style>
  /* Glow effect for hotspot container */
  .hotspot-container-glow {
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.4), 0 0 25px rgba(255, 255, 255, 0.3);
    border-radius: 8px;
  }
  
  /* Footer-like background */
  .product-hotspots-with-blurred-background {
    position: relative;
    overflow: hidden;
    background: #121212 !important;
  }
  
  .product-hotspots-with-blurred-background::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 0;
    background: inherit;
    filter: blur(20px) brightness(0.7);
    transform: scale(1.1);
    opacity: 0.8;
  }
  
  .product-hotspots-with-blurred-background::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 0;
    background: rgba(0, 0, 0, calc(var(--darkness-value, 60) / 100));
  }
  
  .product-hotspots-with-blurred-background[data-darkness] {
    --darkness-value: 60;
  }
  
  .product-hotspots-with-blurred-background[data-darkness="0"] {
    --darkness-value: 0;
  }
  
  .product-hotspots-with-blurred-background[data-darkness="10"] {
    --darkness-value: 10;
  }
  
  .product-hotspots-with-blurred-background[data-darkness="20"] {
    --darkness-value: 20;
  }
  
  .product-hotspots-with-blurred-background[data-darkness="30"] {
    --darkness-value: 30;
  }
  
  .product-hotspots-with-blurred-background[data-darkness="40"] {
    --darkness-value: 40;
  }
  
  .product-hotspots-with-blurred-background[data-darkness="50"] {
    --darkness-value: 50;
  }
  
  .product-hotspots-with-blurred-background[data-darkness="60"] {
    --darkness-value: 60;
  }
  
  .product-hotspots-with-blurred-background[data-darkness="70"] {
    --darkness-value: 70;
  }
  
  .product-hotspots-with-blurred-background[data-darkness="80"] {
    --darkness-value: 80;
  }
  
  .product-hotspots-with-blurred-background[data-darkness="90"] {
    --darkness-value: 90;
  }
  
  .product-hotspots-with-blurred-background[data-darkness="100"] {
    --darkness-value: 100;
  }
  
  .product-hotspots-with-blurred-background > * {
    position: relative;
    z-index: 1;
  }
  
  .product-hotspots-with-statistics .statistics-carousel {
    max-width: 100%;
    margin: 0 auto;
  }
  
  .product-hotspots-with-statistics .statistics-item {
    padding: 40px 24px;
    width: 100%;
  }
  
  .product-hotspots-with-statistics .statistics-number {
    font-size: 120px;
    font-weight: 900;
    line-height: 1.1;
    margin-bottom: 20px;
    background: linear-gradient(to bottom, #C00000, #000000);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    display: inline-block;
    letter-spacing: -2px;
    white-space: nowrap;
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5)) drop-shadow(0 0 12px rgba(255, 255, 255, 0.4));
  }
  
  .product-hotspots-with-statistics .statistics-number .js-number-animate {
    display: inline-block;
    line-height: 1.1;
    vertical-align: baseline;
    letter-spacing: -2px;
  }
  
  .product-hotspots-with-statistics .statistics-suffix,
  .product-hotspots-with-statistics .statistics-suffix-auto {
    font-size: 120px !important;
    font-weight: 900 !important;
    background: linear-gradient(to bottom, #C00000, #000000) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent !important;
    background-clip: text !important;
    margin-left: 0 !important;
    display: inline-block !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative !important;
    z-index: 1 !important;
    line-height: 1.1 !important;
    vertical-align: baseline !important;
    letter-spacing: -2px !important;
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5)) drop-shadow(0 0 12px rgba(255, 255, 255, 0.4)) !important;
  }
  
  .product-hotspots-with-statistics .statistics-label {
    font-size: 20px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 12px;
    color: rgba(var(--color-foreground), 0.9);
  }
  
  .product-hotspots-with-statistics .statistics-description {
    font-size: 14px;
    color: rgba(var(--color-foreground), 0.7);
  }
  
  /* Carousel - לא loop */
  .product-hotspots-with-statistics .statistics-carousel .js-carousel-items {
    scroll-snap-type: x mandatory;
  }
  
  .product-hotspots-with-statistics .statistics-carousel .js-carousel-item {
    scroll-snap-align: center;
    flex: 0 0 100% !important;
  }
  
  @media (max-width: 749px) {
    .product-hotspots-with-statistics .statistics-number {
      font-size: 80px;
      display: inline-block !important;
      letter-spacing: -2px;
    }
    
    .product-hotspots-with-statistics .statistics-number .js-number-animate {
      letter-spacing: -2px;
    }
    
    .product-hotspots-with-statistics .statistics-suffix,
    .product-hotspots-with-statistics .statistics-suffix-auto {
      font-size: 80px !important;
      font-weight: 900 !important;
      background: linear-gradient(to bottom, #C00000, #000000) !important;
      -webkit-background-clip: text !important;
      -webkit-text-fill-color: transparent !important;
      background-clip: text !important;
      margin-left: 0 !important;
      display: inline-block !important;
      visibility: visible !important;
      opacity: 1 !important;
      position: relative !important;
      z-index: 1 !important;
      line-height: 1.1 !important;
      vertical-align: baseline !important;
      letter-spacing: -2px !important;
      filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.5)) drop-shadow(0 0 10px rgba(255, 255, 255, 0.4)) !important;
    }
    
    .hotspot-container-glow {
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.4), 0 0 20px rgba(255, 255, 255, 0.3);
    }
    
    .product-hotspots-with-statistics .statistics-number {
      filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.5)) drop-shadow(0 0 10px rgba(255, 255, 255, 0.4));
    }
    
    .product-hotspots-with-statistics .statistics-item {
      padding: 40px 24px;
    }
    
    .product-hotspots-with-statistics .statistics-label {
      font-size: 16px;
    }
  }
</style>

{% schema %}
{
  "name": "t:general.product_hotspots",
  "disabled_on": {
    "groups": [
      "header",
      "footer"
    ]
  },
  "settings": [
    {
      "type": "header",
      "content": "t:general.general"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:general.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "t:general.section_subheading"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:general.section_heading",
      "default": "Product hotspots"
    },
    {
      "type": "text",
      "id": "description",
      "label": "t:general.section_description"
    },
    {
      "type": "header",
      "content": "Background"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "info": "Optional background color for the section"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background image",
      "info": "Optional background image for the section"
    },
    {
      "type": "range",
      "id": "background_darkness",
      "label": "Background darkness",
      "min": 0,
      "max": 100,
      "step": 10,
      "default": 60,
      "unit": "%",
      "info": "Control the darkness overlay on the background (0% = no darkness, 100% = completely black)"
    },
    {
      "type": "header",
      "content": "t:general.layout"
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "label": "t:general.show_navigation_on_mobile",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_statistics_navigation",
      "label": "Show statistics navigation",
      "default": true
    },
    {
      "type": "range",
      "id": "animation_duration",
      "label": "Animation duration (ms)",
      "min": 500,
      "max": 3000,
      "default": 1000,
      "step": 100
    },
    {
      "type": "checkbox",
      "id": "remove_padding_top",
      "label": "t:general.remove_padding_top",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "remove_padding_bottom",
      "label": "t:general.remove_padding_bottom",
      "default": false
    },
    {
      "type": "header",
      "content": "t:general.image"
    },
    {
      "type": "image_picker",
      "id": "image_hotspot",
      "label": "t:general.image",
      "info": "t:general.product_hotspots_image_info"
    },
    {
      "type": "header",
      "content": "t:general.prominent_badge"
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "t:general.text",
      "info": "t:general.prominent_badge_text_info"
    },
    {
      "type": "select",
      "id": "badge_color",
      "label": "t:general.accent_scheme",
      "default": "color-accent-1",
      "visible_if": "{{ section.settings.badge_text != blank }}",
      "options": [
        {
          "value": "color-accent-1",
          "label": "t:general.main"
        },
        {
          "value": "color-accent-2",
          "label": "t:general.extra"
        }
      ]
    },
    {
      "type": "select",
      "id": "badge_position",
      "label": "t:general.position",
      "default": "p-badge--top-left",
      "visible_if": "{{ section.settings.badge_text != blank }}",
      "options": [
        {
          "value": "p-badge--top-left",
          "label": "t:general.left"
        },
        {
          "value": "p-badge--top-right",
          "label": "t:general.right"
        }
      ]
    },
    {
      "type": "select",
      "id": "badge_shape",
      "label": "t:general.shape",
      "default": "badge--star",
      "visible_if": "{{ section.settings.badge_text != blank }}",
      "options": [
        {
          "value": "badge--star",
          "label": "t:general.star"
        },
        {
          "value": "badge--diamond",
          "label": "t:general.diamond"
        },
        {
          "value": "badge--asterisk",
          "label": "t:general.asterisk"
        }
      ]
    }
  ],
  "blocks": [
    {
      "type": "hotspot",
      "name": "t:general.hotspot_item",
      "limit": 3,
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "t:general.product"
        },
        {
          "type": "range",
          "id": "top_offset",
          "label": "t:general.top_offset",
          "min": 0,
          "max": 100,
          "default": 30,
          "unit": "%"
        },
        {
          "type": "range",
          "id": "left_offset",
          "label": "t:general.left_offset",
          "min": 0,
          "max": 100,
          "default": 25,
          "unit": "%"
        }
      ]
    },
    {
      "type": "statistic",
      "name": "Statistic",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "HAPPY ANIME FANS"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "info": "Optional description text"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:general.product_hotspots",
      "blocks": [
        {
          "type": "hotspot",
          "settings": {
            "product": "",
            "top_offset": 30,
            "left_offset": 25
          }
        },
        {
          "type": "hotspot",
          "settings": {
            "product": "",
            "top_offset": 45,
            "left_offset": 40
          }
        },
        {
          "type": "hotspot",
          "settings": {
            "product": "",
            "top_offset": 60,
            "left_offset": 75
          }
        }
      ]
    }
  ]
}
{% endschema %}
