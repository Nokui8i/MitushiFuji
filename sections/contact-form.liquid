{%- liquid
  assign loading = "lazy"
  assign decoding ="async"
  assign fetchpriority = "auto"

  if section.index == 1
    assign loading = "eager"
    assign fetchpriority = "high"
  endif
  assign section_id = section.id | md5 | truncate: 12, ""
  assign formID = section_id | prepend: 'cf-'
  
  assign media_width_desktop = 'calc(100vw / 3)'

  if settings.enable_content_max_width
    assign media_width_desktop = 'calc(min(100vw, ' | append: settings.content_max_width | append: 'px) / 3)'
  endif

  assign sizes = '(min-width: 769px) ' | append: media_width_desktop | append: ', ' | append: '100vw'
  assign widths = '240, 352, 550, 832, 1200, 1600, 1920, 2560, 3840'

  assign form_image_alt  = section.settings.contact_image.alt | default: section.settings.contact_image.image | split: '/' | last
  assign form_image = section.settings.contact_image | image_url: width: section.settings.contact_image.width | image_tag: widths: widths, sizes: sizes, alt: form_image_alt, class: 'js-image-lazy media w-100 of-cover', loading: loading, fetchpriority: fetchpriority, decoding: decoding

  assign ratio = section.settings.image_ratio
  if section.settings.image_ratio == 'auto'
    assign ratio = section.settings.contact_image.aspect_ratio
  endif
-%}
{% if form_image %}
  {% assign error_class= " start-lg " %}
  {% capture form_image_html %}
    <div class="clm o-hidden" style="--w-xs:12;--w-sm:12;--w-md:4;">
      {% render 'image', image_item: form_image, image_classes: 'js-animate anm anm-zoomOut', media_wrap_style: '--delay: 0s;', ratio: ratio %}
    </div>
  {% endcapture %}
{%  else %}
  {% assign submit_button_class= " center-md " %}
{% endif %}

<div class="section color-{{ section.settings.color_scheme }} {{ section.settings.remove_padding_top | replace: 'true', 'section-top-zero' | replace: section.settings.remove_padding_top, '' }} {{ section.settings.remove_padding_bottom | replace: 'true', 'section-bottom-zero' | replace: section.settings.remove_padding_bottom, '' }} {% render 'animation-loader', section: section %}" data-ui-component="Contact Form Section" role="region" aria-labelledby="sectionHeading-{{ section_id }}">
  <div class="ctnr">
    {% render 'section-header', heading: section.settings.heading, content_align: 'ta-center' %}
    <div class="s-content rw center-xs r-gap-48 r-gap-sm-36 {% if section.settings.content_ordering == 'fd-row-reverse' %}{{ section.settings.content_ordering }}{% endif %}">
      <div class="clm m-zero-md js-animate anm" style="--w-xs:12;--w-sm:12;--w-md:8; --duration: .6s; --delay: .3s;">
        {%- form 'contact', id: formID, class: 'form-contact' -%}
          {%- if form.posted_successfully? -%}
            <div class="d-flex middle-xs mb-32 center-xs {{ error_class }}">
              <div class="icon icon--small icon--success fs-0">
                {% render 'icon-check-mark', size: 16 %}
              </div>
              <span class="ml-8 subtext">
                {{ 'templates.contact.form.post_success' | t }}
              </span>
            </div>
          {%- elsif form.errors -%}
            <div class="d-flex middle-xs mb-32 center-xs {{ error_class }}">
              <div class="icon icon--small icon--error fs-0">
                {% render 'icon-error', size: 16 %}
              </div>
              <span class="ml-8 subtext">
                {{ 'templates.contact.form.error_heading' | t }}
              </span>
            </div>
          {%- endif -%}
          <div class="rw gap-equal">
            <div class="clm field" style="--w-xs:12;--w-md:6">
              <label class="d-block field__label mb-12" for="{{ formID }}-name">{{ 'templates.contact.form.name' | t }}</label>
              <div class="field--animation">
                <input class="field__text w-100" autocomplete="name" type="text" id="{{ formID }}-name" name="contact[Name]" value="{% if form.name %}{{ form.name }}{% elsif customer %}{{ customer.name }}{% endif %}" placeholder="{{ 'templates.contact.form.name_placeholder' | t }}">
              </div>
            </div>
            <div class="clm field" style="--w-xs:12;--w-md:6">
              <label class="field__label mb-12 d-block p-relative" for="{{ formID }}-email">{{ 'templates.contact.form.email' | t }}<sup class="p-absolute ml-4 color-danger">*</sup></label>
              <div class="field--animation">
                <input
                  autocomplete="email"
                  type="email"
                  id="{{ formID }}-email"
                  class="field__text w-100"
                  name="contact[email]"
                  spellcheck="false"
                  autocapitalize="off"
                  value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}"
                  aria-required="true"
                  placeholder="{{ 'templates.contact.form.email_placeholder' | t }}"
                  required
                >
              </div>
            </div>
            {%- for block in section.blocks -%}
              {%- case block.type -%}
                {%- when 'text_field' -%}
                  <div class="clm field" style="--w-xs:12;--w-md:12" {{ block.shopify_attributes }}>
                    <label class="d-block field__label mb-12 p-relative" for="{{ formID }}-{{ forloop.index }}-custom">
                      {{ block.settings.label }}
                      <sup class="p-absolute ml-4 color-danger {{ block.settings.required | default: 'd-none' | replace: 'true', 'p-absolute ml-4 color-danger' }}">*</sup>
                    </label>
                    <div class="field--animation">
                      {%- if block.settings.textarea -%}
                        <textarea
                          rows="5"
                          id="{{ formID }}-{{ forloop.index }}-custom"
                          class="textarea field__text w-100"
                          name="contact[{{ block.settings.label }}]"
                          placeholder="{{ block.settings.placeholder }}"
                          {{ block.settings.required | default: '' | replace: 'true', 'required' }}
                          >
                          {{- form.body -}}
                        </textarea>
                      {%- else -%}
                        <input
                        class="field__text w-100"
                        type="text"
                        id="{{ formID }}-{{ forloop.index }}-custom"
                        name="contact[{{ block.settings.label }}]"
                        placeholder="{{ block.settings.placeholder }}"
                        {{ block.settings.required | default: '' | replace: 'true', 'required' }}
                        >
                      {%- endif -%}
                    </div>
                  </div>
                {%- when 'dropdown' -%}
                  <div class="clm field" style="--w-xs:12;--w-md:12" {{ block.shopify_attributes }}>
                    <label class="d-block field__label mb-12 p-relative" for="{{ formID }}-{{ forloop.index }}-dropdown">
                      {{ block.settings.label }}
                    </label>
                    {% assign options = block.settings.add_value | split: ',' %}
                    <div class="field__select p-relative">
                      <div class="field--animation">
                        <select class="field__text w-100 color-text-regular" name="contact[{{ block.settings.label }}]" id="{{ formID }}-{{ forloop.index }}-dropdown">
                          {% for value in options %}
                            <option value="{{value}}">{{ value }}</option>
                          {% endfor %}
                        </select>
                      </div>
                      <span class="btn btn-large btn-icon p-absolute right-0 top-0 pe-none">
                        {% render 'icon-arrow-animation' %}
                      </span>
                    </div>
                  </div>
              {%- endcase -%}
            {%- endfor -%}
            <div class="clm field" style="--w-xs:12;">
              <label class="field__label mb-12 p-relative d-block" for="{{ formID }}-message">{{ 'templates.contact.form.message' | t }}<sup class="p-absolute ml-4 color-danger">*</sup></label>
              <div class="field--animation">
                <textarea
                  rows="5"
                  id="{{ formID }}-message"
                  required
                  class="textarea field__text w-100"
                  name="contact[{{ 'templates.contact.form.message_title' | t }}]"
                  placeholder="{{ 'templates.contact.form.message_placeholder' | t }}"
                >
                  {{- form.body -}}
                </textarea>
              </div>
            </div>
            <div class="clm field d-flex fd-column fd-row-sm center-xs start-md mt-32 mt-sm-12 mt-md-0 {{ submit_button_class }}" style="--w-xs:12;">
              <button type="submit" class="btn btn-primary--animate btn-large c-pointer">
                <span class="d-block o-hidden p-relative">
                  <span class="btn-primary__content">
                    {{- section.settings.button_label | default: 'Send message' -}}
                  </span>
                </span>
              </button>
            </div>
          </div>
        {%- endform -%}
      </div>
      {{ form_image_html }}
    </div>
  </div>
</div>
{% schema %}
{
  "name": "t:general.contact_form",
  "disabled_on": {
    "groups": [
      "header",
      "footer"
    ]
  },
  "settings": [
    {
      "type": "header",
      "content": "t:general.general"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:general.color_scheme",
      "default": "accent-1"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:general.section_heading",
      "default": "Contact form"
    },
    {
      "type": "header",
      "content": "t:general.layout"
    },
    {
      "type": "select",
      "id": "content_ordering",
      "label": "t:general.content_ordering_on_desktop",
      "default": "text_first",
      "options": [
        {
          "value": "text_first",
          "label": "t:general.text_first"
        },
        {
          "value": "fd-row-reverse",
          "label": "t:general.image_first"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "remove_padding_top",
      "label": "t:general.remove_padding_top",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "remove_padding_bottom",
      "label": "t:general.remove_padding_bottom",
      "default": false
    },
    {
      "type": "header",
      "content": "t:general.image"
    },
    {
      "type": "image_picker",
      "id": "contact_image",
      "label": "t:general.image",
      "info": "t:general.desktop_background_image_info"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "t:general.image_ratio",
      "default": "auto",
      "options": [
        {
          "value": "1/1",
          "label": "t:general.square"
        },
        {
          "value": "2/3",
          "label": "t:general.portrait"
        },
        {
          "value": "3/2",
          "label": "t:general.landscape"
        },
        {
          "value": "auto",
          "label": "t:general.adapt_to_image"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:general.button"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "t:general.label",
      "default": "Send message"
    }
  ],
  "blocks": [
    {
      "type": "text_field",
      "name": "t:general.custom_text_field",
      "limit": 3,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "t:general.label",
          "default": "Custom text field label"
        },
        {
          "type": "text",
          "id": "placeholder",
          "label": "t:general.placeholder",
          "default": "Placeholder"
        },
        {
          "type": "checkbox",
          "id": "required",
          "label": "t:general.required_field",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "textarea",
          "label": "t:general.use_as_textarea",
          "default": false
        }
      ]
    },
    {
      "type": "dropdown",
      "name": "t:general.custom_dropdown",
      "limit": 3,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "t:general.label",
          "default": "Custom dropdown label"
        },
        {
          "type": "text",
          "id": "add_value",
          "label": "t:general.value",
          "default": "value1, value2, value3",
          "info": "t:general.value_info"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:general.contact_form"
    }
  ]
}
{% endschema %}
